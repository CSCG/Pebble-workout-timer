<!-- Note. I ham officially obsessed with jQueryMobile --> 

<html> 
    <head> 
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
        <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
        <style>
            .error{ 
                text-align: center; 
                background-color: rgba(255, 0,0,.2);
                padding: 3px;
            }

         </style> 
    </head> 

        <div data-role="page" id="settings" data-url="settings" class="">

            <div data-role="content"> 
                <div class="error" id="update" hidden><strong> There is an update for this app available on the Pebble appstore. </strong> </div>
                <h2>Add a custom timer <a href="#info" data-transition="flip"><button data-inline="true" data-mini="true" data-icon="info"> FAQ </button></a></h2>  
            
                <form id="settings"> 
                        <label for="title">  Workout Title:</label>       <input type="text" required name="title" id="title" data-clear-btn="true"> <br>  
                        <hr>   
                        <label for="move-name">Add Move: </label> <input type="text" id="move-name" data-clear-btn="true"> 
                        <label for="minute-slider" class="">Minutes</label>
                        <input type="range" name="minute-slider" id="minute-slider" data-highlight="true" min="0" max="15" value="0" step="1">
                        <label for="second-slider" class="">Seconds</label>
                        <input type="range" name="second-slider" id="second-slider" data-highlight="true" min="0" max="59" value="0" step="1">
                </form> 

                <button  id="add-move" data-icon="plus"> Add Move</button> <br> 
                <div class="error" id="error1" hidden>Please enter a move title and time</div>
                <hr>

                <div id="titletext"> </div> 
                <ol id="move-list" data-role="listview"> </ol>
                <br> 

                <fieldset class="ui-grid-a">
                    <div class="ui-block-a" > <button id = "cancel-btn" data-theme="d" data-icon="delete"> Cancel </button> </div> 
                    <div class="ui-block-b" > <button id = "save-btn" data-theme="b" data-icon="check"> Save</button> </div> 
                </fieldset>

                <div class="error" id="error2" hidden>Please enter a workout title and add at least one move</div>

                <script>
                    $(document).ready(function(){
                        
                        //Check if there is an update available. 
                        var version = $(location).attr('href').split('?ver=')[1]; 
                        if (version != "1.0") { 
                            $("#update").fadeIn(); 
                        }

                        var workout = {};
                        workout["moves"]= []; 

                        $("#title").change(function(){ 
                            $("#titletext").html("<h3>" + $("#title").val() + "</h3>")
                        })
          
                        $("#add-move").click(function(){

                            var move = $("#move-name").val();
                            var mins = $("#minute-slider").val(); 
                            var secs = $("#second-slider").val(); 
                            console.log(move)
                            if (move != "" && (mins > 0 || secs >0)) {          
                                var time = (parseInt(mins)*60)+parseInt(secs)
                                console.log(time); 

                                //Add to list nicely b/c grammar Nazis
                                var mintext = "minutes"
                                if (mins == 1) mintext = "minute"
                                var sectext = "seconds"
                                if (secs == 1) sectext = "second"
                                if (mins > 0){ 
                                    if (secs > 0) $("#move-list").append("<li>" + move+ " </strong>for " + mins + " " + mintext + " and " + secs + " " + sectext +".</li>");
                                    else $("#move-list").append("<li>" + move+ " </strong>for " + mins + " " + mintext +".</li>");
                                }
                                else $("#move-list").append("<li><strong>" + move+ " </strong>for " + secs + " " + sectext + ".</li>");

                                workout["moves"].push([move, time]) // Add to workout

                                console.log("appended " + title)
                                console.log(workout)
                                //Reset Values
                                $("#move-name").val("");
                                $("#minute-slider").val("0"); 
                                $("#minute-slider").slider("refresh"); 
                                $("#second-slider").val("0"); 
                                $("#second-slider").slider("refresh"); 
                                $('#move-list').listview('refresh');
                                $("#error1").fadeOut()

                            }
                            else { 
                                $("#error1").fadeIn()
                            }
                            
                        })
                      
                        $("#save-btn").click(function() {
                            if ($("#move-list").html() != " " && $("#title").val() != "") {
                            workout["title"] = $("#title").val()
                            document.location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(workout)) 
                            }   
                            else { $("#error2").fadeIn()}
                        })

                        $("#cancel-btn").click(function() { 
                            document.location = "pebblejs://close#" 
                        })   
                    })

                </script> 
            </div> 
        </div> <!-- End of settings page --> 

        <!-- FAQ Page --> 
        <style> 
            .ui-li-desc{ 
                overflow: visible;
                white-space: normal;
            }
        </style>
        <div data-role="page" id="info" data-url="info">
            <h3> <a href="#settings" data-transition="flip"><button data-inline="true" data-mini="true" data-icon="back"> Back</button></a> Frequently Asked Questions </h1> 
            <ul data-role="listview"> 
                <li> <div class="ui-li-heading"> How do I add a workout? </div>  <p class ="ui-li-desc"> On the Pebble app, find this app and click on the settings icon. Type in a workout title and add moves by using the sliders and textbox. You can add as many moves as you want.  When you are done, click on Add workout. The workout should appear on your Pebble. </p>  </li> 
                <li> <div class="ui-li-heading"> How do I delete a workout? </div>  <p class ="ui-li-desc"> On the Pebble app, with the workout selected, press and hold the middle button. The pebble should vibrate and the workout should dissapear. </p>  </li> 
                <li> <div class="ui-li-heading"> How do I pause/resume a timer? </div>  <p class ="ui-li-desc"> While a timer is running, simply press the middle button to pause or resume. </p>  </li> 
                 <li> <div class="ui-li-heading">Can I suggest a new feature? </div>  <p class ="ui-li-desc"> Yes, please. That would be awesome. If you have any ideas to improve this app, or ideas for another app please email me at <a href="mailto:trujano.fernando@gmail.com?subject=App Suggestion"> trujano.fernando@gmail.com </a>  </p>  </li>                
                <li> <div class="ui-li-heading"> Something went wrong!</div>  <p class ="ui-li-desc"> That is not a question. If you think you found a bug, please <a href="mailto:trujano.fernando@gmail.com?subject=Custom Workout Timer bug!"> email </a> me the details. Uninstalling and reinsalling the app might solve your problem for now.  </p>  </li> 
            </ul> 
        </div> 

    </body> 

</html> 